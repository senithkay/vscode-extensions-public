trigger:
  batch: true
  branches:
    include:
      - "*"

pr:
  branches:
    include:
      - "*"

pool:
  vmImage: "ubuntu-latest"

jobs:
  - job: Choreo
    displayName: Choreo Job
    timeoutInMinutes: 120

    variables:
      - group: codeserver-cdn-group

    steps:
      - task: NodeTool@0
        inputs:
          versionSpec: 16.x

      - script: |
          sudo apt-get install unzip
        displayName: "Install required dependencies"

      - script: |
          mkdir extractedDistribution
          curl http://dist-dev.ballerina.io/downloads/${{ github.event.inputs.bal_dist_version }}/ballerina-${{ github.event.inputs.bal_dist_version }}.zip --output ballerina-${{ github.event.inputs.bal_dist_version }}.zip
          unzip -qq ./ballerina-${{ github.event.inputs.bal_dist_version }}.zip -d ./extractedDistribution
          rm ballerina-${{ github.event.inputs.bal_dist_version }}.zip
        displayName: "Set up Ballerina"

      - script: sudo apt-get install xvfb && xvfb-run --auto-servernum ./gradlew clean build
        displayName: "Build plugin repo"
        env:
          NODE_AUTH_TOKEN: $(NPM_ACCESS_TOKEN)
