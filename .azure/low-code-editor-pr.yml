parameters:
- name: ballerina_dist_uri
  displayName: Ballerina distrbution deb uri
  type: string
  default: https://dist.ballerina.io/downloads/2201.0.0/ballerina-2201.0.0-swan-lake-linux-x64.deb
- name: ballerina_dist_name
  displayName: Ballerina distrbution deb name
  type: string
  default: ballerina-2201.0.0-swan-lake-linux-x64.deb

trigger:
  batch: true
  branches:
    include:
    - '*'

pr:
  branches:
    include:
    - '*'

pool:
  vmImage: 'ubuntu-latest'

steps:
  - script: |
      sudo apt-get install libgtk2.0-0 libgtk-3-0 libgbm-dev libnotify-dev libgconf-2-4 libnss3 libxss1 libasound2 libxtst6 xauth xvfb
    displayName: "Install Cypress Depencies"

  - script: |
      wget ${{parameters.ballerina_dist_uri}}
      sudo dpkg -i ${{parameters.ballerina_dist_name}}
    displayName: "Install Ballerina"
  
  - script: |
      wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
      sudo dpkg -i google-chrome-stable_current_amd64.deb
    displayName: "Install Chrome Stable Version"

  - task: NodeTool@0
    inputs:
      versionSpec: 16.x

  - script: npm run build
    displayName: "Build Mono Repo"

  - script: npm test
    displayName: "Run Integration Tests"
  