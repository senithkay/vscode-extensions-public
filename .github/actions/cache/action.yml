name: 'Cache'
description: 'Cache Rush and pnmp'
# runs:
#   using: 'node16'
#   main: 'dist/restore/index.js'
#   post: 'dist/save/index.js'
runs:
  using: "composite"
  steps:
    - uses: pnpm/action-setup@v2
      with:
        version: 7.26.3

    - name: Use Node.js 16.x
      uses: actions/setup-node@v3
      with:
        node-version: 16.x

    - name: Cache Rush
      uses: actions/cache@v2
      with:
        path: |
          common/temp/install-run
          ~/.rush
        key: Rush-cache-${{ hashFiles('rush.json') }}

    - name: Cache pnpm
      uses: actions/cache@v3
      with:
        path: |
          common/temp/pnpm-store
          ~/.cache/Cypress
        key: pnpm-cache-${{ runner.os }}-${{ hashFiles('**/pnpm-lock.yaml') }}

    - name: Set ENVs
      shell: bash
      run: echo "ACTIONS_CACHE_URL=$(echo "${{ ACTIONS_ID_TOKEN_REQUEST_URL }}" | grep -Po 'https://[^/]+/[^/]+/' | sed  's/pipelines/artifactcache/')" >> $GITHUB_ENV

    - name: Install node modules
      shell: bash
      run: node common/scripts/install-run-rush.js install        
