name: 'Cache'
description: 'Cache Rush and pnmp'
# runs:
#   using: 'node16'
#   main: 'dist/restore/index.js'
#   post: 'dist/save/index.js'
runs:
  using: "composite"
  steps:
    - uses: pnpm/action-setup@v2
      with:
        version: 7.26.3

    - name: Use Node.js 16.x
      uses: actions/setup-node@v3
      with:
        node-version: 16.x

    - name: Cache Rush
      uses: actions/cache@v2
      with:
        path: |
          common/temp/install-run
          ~/.rush
        key: Rush-cache-$(cat ./rush.json | git hash-object --stdin)

    - name: Cache pnpm
      uses: actions/cache@v3
      with:
        path: |
          common/temp/pnpm-store
          ~/.cache/Cypress
        key: pnpm-cache-$RUNNER_OS-$(cat **/pnpm-lock.yaml | git hash-object --stdin)

    - name: Set ENVs
      shell: bash
      run: |
        echo "ACTIONS_CACHE_URL=https://github.com/${{ github.repository }}/actions/cache" >> $GITHUB_ENV

    - name: Install node modules
      shell: bash
      run: node common/scripts/install-run-rush.js install        
